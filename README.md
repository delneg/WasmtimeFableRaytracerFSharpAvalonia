# Wasmtime executing WASM code in Avalonia.FuncUI desktop app generated by Fable Rust and wasm-pac

## Fully F# all the way

Fable Rust Raytracer demo made by @ncave (https://github.com/ncave/fable-raytracer), also check out iOS Static library version https://github.com/delneg/fable-raytracer-ios-net6/

## Preview
![gif](https://github.com/delneg/WasmtimeFableRaytracerFSharpAvalonia/blob/master/assets/demo.gif?raw=true)

## Fable

This project uses Fable 4 Snake Island Preview.

Please check out [this blog post](https://fable.io/blog/2022/2022-06-06-Snake_Island_alpha.html) for more info.


## Wasmtime

This project uses [wasmtime-dotnet](https://github.com/bytecodealliance/wasmtime-dotnet) to execute Wasm. 

Please check out [wasmtime website](https://wasmtime.dev/) for more info.

## Pre-requisites


- install [.NET 7](https://dotnet.microsoft.com/en-us/download/dotnet/7.0)
- install [Rust](https://www.rust-lang.org/tools/install) and [wasm-pack](https://rustwasm.github.io/wasm-pack/installer/)


- Optionally, install [Node.js & npm](https://nodejs.org/en/) in order to run `package.json` script


## Build & Run

### Using npm

```bash
npm run run
```

### Manually

```bash
dotnet tool restore
dotnet fable FableRustRaytracer/FableRustRaytracer.fsproj --lang rust --outDir FableRustRaytracer/
# this throws an error, but it's safe to ignore
# ./FableRustRaytracer/RayTracer.fs(157,34): (157,69) error FABLE: System.Double.Pow is not supported by Fable
wasm-pack build FableRustRaytracer/ --target nodejs
dotnet run --project WasiFableRaytracerFSharpAvalonia/WasiFableRaytracerFSharpAvalonia.fsproj
```


## Why ?

Because why not.
An example use case for this may be some existing WASM code that you want to use in your desktop app or for example some .NET code that performs better when compiled to Rust and then WASM.
